/* Aggressive iOS Safari Fixes - Apply with !important */

/* Webkit specific stacking context fixes */
@supports (-webkit-touch-callout: none) {
	/* This targets webkit browsers like iOS Safari */

	/* Force toolbar on top with webkit isolation */
	.app-toolbar {
		position: relative !important;
		z-index: 99999 !important;
		-webkit-transform: translateZ(0) !important;
		transform: translateZ(0) !important;
		will-change: transform !important;
		isolation: isolate !important;
		background: white !important;
	}

	/* Force canvas container to be contained */
	.canvas-container {
		position: relative !important;
		z-index: 1 !important;
		isolation: isolate !important;
		-webkit-transform: translateZ(0) !important;
		transform: translateZ(0) !important;
		contain: layout style paint !important;
	}

	/* Force SVG overlay above items but below toolbar */
	.canvas-svg {
		position: relative !important;
		z-index: 100 !important;
		-webkit-transform: translateZ(0) !important;
		transform: translateZ(0) !important;
		will-change: transform !important;
		pointer-events: auto !important;
		touch-action: none !important;
		-webkit-touch-callout: none !important;
		-webkit-user-select: none !important;
		user-select: none !important;
	}

	/* Force items layer below SVG */
	.items-html-layer {
		position: relative !important;
		z-index: 50 !important;
		-webkit-transform: translateZ(0) !important;
		transform: translateZ(0) !important;
		isolation: isolate !important;
	}

	/* Fix for foreign object in SVG */
	foreignObject {
		position: relative !important;
		z-index: 50 !important;
	}

	/* Ensure all SVG elements are properly layered */
	svg g {
		position: relative !important;
		z-index: inherit !important;
	}

	/* Force SVG overlay groups to be interactive and above items */
	[data-layer="selection-overlays"],
	[data-layer="presence-overlays"],
	[data-layer="comment-overlays"] {
		pointer-events: auto !important;
		touch-action: none !important;
		-webkit-touch-callout: none !important;
		-webkit-user-select: none !important;
		user-select: none !important;
		z-index: 1000 !important;
	}

	/* Force foreignObject to be below overlays */
	foreignObject {
		position: relative !important;
		z-index: -10 !important;
	}

	/* Fix touch events on iOS */
	svg,
	canvas,
	.canvas-svg {
		-webkit-tap-highlight-color: transparent !important;
		-webkit-touch-callout: none !important;
		-webkit-user-select: none !important;
		user-select: none !important;
		touch-action: none !important;
	}
}

/* Additional iOS specific fixes */
@media screen and (-webkit-min-device-pixel-ratio: 2) {
	/* High DPI iOS devices */

	.canvas-svg {
		-webkit-backface-visibility: hidden !important;
		backface-visibility: hidden !important;
		-webkit-perspective: 1000 !important;
		perspective: 1000 !important;
	}
}
